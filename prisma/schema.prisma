// This is your Prisma schema file
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- USER AND PROFILE MODELS ---
model User {
  id        String           @id @default(cuid())
  email     String           @unique
  password  String
  role      Role             @default(EMPLOYEE)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  profile   EmployeeProfile?
}

model EmployeeProfile {
  id            String         @id @default(cuid())
  userId        String         @unique
  user          User           @relation(fields: [userId], references: [id])
  firstName     String
  lastName      String
  position      String
  startDate     DateTime
  managerId     String?
  manager       EmployeeProfile? @relation("DirectReports", fields: [managerId], references: [id])
  directReports EmployeeProfile[]  @relation("DirectReports")
  leaveRequests LeaveRequest[]
  leaveBalances LeaveBalance[]
}

// --- LEAVE MANAGEMENT MODELS (FINAL VERSION) ---
model LeaveType {
  id               String         @id @default(cuid())
  name             String         @unique
  defaultAllowance Float          @default(0)
  unit             LeaveUnit      @default(DAYS)
  cadence          LeaveCadence   @default(ANNUAL)
  balances         LeaveBalance[]
  requests         LeaveRequest[]
}

model LeaveBalance {
  id               String          @id @default(cuid())
  employeeId       String
  employee         EmployeeProfile @relation(fields: [employeeId], references: [id])
  leaveTypeId      String
  leaveType        LeaveType       @relation(fields: [leaveTypeId], references: [id])
  total            Float
  remaining        Float
  year             Int
  month            Int?
  isManualOverride Boolean         @default(false) // New flag to track manual changes

  @@unique([employeeId, leaveTypeId, year, month])
}

model LeaveRequest {
  id          String          @id @default(cuid())
  employeeId  String
  employee    EmployeeProfile @relation(fields: [employeeId], references: [id])
  leaveTypeId String
  leaveType   LeaveType       @relation(fields: [leaveTypeId], references: [id])
  startDate   DateTime
  endDate     DateTime
  status      LeaveStatus     @default(PENDING)
  denialReason String?        // New field for denial reasons
  createdAt   DateTime        @default(now())
}

// --- ENUMS (pre-defined choices) ---
enum Role {
  EMPLOYEE
  ADMIN
  SUPER_ADMIN
}

enum LeaveStatus {
  PENDING
  APPROVED_BY_MANAGER
  APPROVED_BY_ADMIN
  DENIED
}

enum LeaveUnit {
  DAYS
  HOURS
}

enum LeaveCadence {
  ANNUAL
  MONTHLY
}